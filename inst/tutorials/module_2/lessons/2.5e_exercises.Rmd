---
title: "Transforming Data: Exercises"
---

### Your Turn
Now it's your turn to put your newfound knowledge of transforming data into practice. Here are a couple of exercises to get you started.  

Let's imagine you are a data scientist working for a large company called "FutureTech". This company has multiple departments, such as HR, Finance, Marketing, and IT. You have been given access to two datasets:  

- `transform_practice_emp`: Contains general information about each employee, including their ID, age, department, hire date, and performance score.  
- `transform_practice_emp_salary`: Contains salary information for some of the employees.  


### Exercise 1

To begin, use the global variable `emp_path` as the `path` attribute to import the dataset. Save the dataset in a variable called `emp_data` and inspect the first few rows.  

```{r, emp-data-setup}
emp_path <- system.file("extdata", "transform_practice_emp.csv", package = "learnrIO", mustWork = TRUE)
```

```{r emp-data, exercise = TRUE, exercise.completion = FALSE}

```

```{r emp-data-hint-1}
emp_data <- ___(___)

___(___)
```

```{r emp-data-hint-2}
emp_data <- read_csv(emp_path)

head(___)
```

```{r emp-data-solution, exercise.reveal_solution = FALSE}
emp_data <- read_csv(emp_path)

head(emp_data)
```

```{r emp-data-check}
# grade_this({
#   if (identical(.result, .solution)) {
#     pass()
#   }
#   fail()
# })
grade_this({
    pass_if_equal()
    fail()
})
```


Now use the global variable `emp_salary_path` as the `path` attribute to import the dataset. Save the dataset in a variable called `emp_salary_data` and inspect the first few rows.  

```{r, emp-salary-setup}
emp_salary_path <- system.file("extdata", "transform_practice_emp_salary.csv", package = "learnrIO", mustWork = TRUE)
```

```{r emp-salary, exercise = TRUE, exercise.completion = FALSE}

```

```{r emp-salary-hint-1}
emp_salary_data <- ___(___)

___(___)
```

```{r emp-salary-hint-2}
emp_salary_data <- read_csv(emp_salary_path)

head(___)
```

```{r emp-salary-solution, exercise.reveal_solution = FALSE}
emp_salary_data <- read_csv(emp_salary_path)

head(emp_salary_data)
```

```{r emp-salary-check}
grade_this({
    pass_if_equal()
    fail()
})
```


###
Call the `summary()` function on `emp_data` to view a summary overview about the dataset. Use the result to answer the follow-up question. *Hint: if you get stuck on the question, try using `is.na()`*  

```{r emp-summary, exercise=TRUE, exercise.completion = FALSE}

```

```{r emp-summary-hint}
summary(___)
```

```{r emp-summary-solution, exercise.reveal_solution = FALSE}
summary(emp_data)
```

```{r emp-summary-question, echo=FALSE}
question("Which variable is missing values?",
  answer("age"),
  answer("department"),
  answer("hire_date"),
  answer("performance_score", correct = TRUE),
  allow_retry = TRUE
)
```



### Exercise 2
For the performance appraisal process, every employee should have a performance score. However, you've noticed that some employees don't have this score in the `emp_data` dataset.  

Perform the following steps:  

- Group by department and create a summarized column called `avg_performance` that calculates the average performance score and removes NAs. Use the `round()` function to round the scores Save the result in a variable called `avg_scores`.  *Hint: use group_by() and summarise()*  
- Left join `avg_scores` with the `emp_data` dataset. Save the result as `updated_emp_data`.  
- Overwrite the `performance_score` to replace missing performance scores with average performance score of their department. Overwrite `updated_emp_data` by saving the result as `updated_emp_data`. *Hint: use mutate(), and call is.na() in an ifelse()*  
- View the `updated_emp_data` tibble.  

```{r ex-2, exercise = TRUE, exercise.completion = FALSE}

```

```{r ex-2-hint-1}
avg_scores <- emp_data |> 
    ___(___) |> 
    ___(avg_performance = round(___(___, ___ = ___)))

___ <- ___ |> 
    ___(___, by = ___)

___ <- ___ |> 
    ___(
        ___ = ___(is.na(___), ___, ___))

___
```

```{r ex-2-hint-2}
avg_scores <- emp_data |> 
    group_by() |> 
    summarise(avg_performance = round(mean(___, na.rm = ___)))

updated_emp_data <- emp_data |> 
    ___(avg_scores, by = "department")

updated_emp_data <- updated_emp_data |> 
    ___(
        performance_score = ifelse(is.na(performance_score), ___, performance_score))

updated_emp_data
```

```{r ex-2-solution, exercise.reveal_solution = TRUE}
avg_scores <- emp_data |> 
    group_by(department) |> 
    summarise(avg_performance = round(mean(performance_score, na.rm = TRUE)))

updated_emp_data <- emp_data |> 
    left_join(avg_scores, by = "department")

updated_emp_data <- updated_emp_data |> 
    mutate(
        performance_score = ifelse(is.na(performance_score), avg_performance, performance_score))

updated_emp_data
```

```{r ex-2-check}
grade_this({
    pass_if_equal()
    fail()
})
```



### Exercise 3
**Part 1**  
You want to join the `updated_emp_data` and `emp_salary_data` datasets so that you have the salary of all employees in one dataset. Join the two datasets on the common variable so that the new dataset only contains matches between the two datasets. Name the new joined dataset `joined_emp_data` and then print the variable.  

```{r ex-3a-setup}
avg_scores <- emp_data |> 
    group_by(department) |> 
    summarise(avg_performance = round(mean(performance_score, na.rm = TRUE)))

updated_emp_data <- emp_data |> 
    left_join(avg_scores, by = "department")

updated_emp_data <- updated_emp_data |> 
    mutate(
        performance_score = ifelse(is.na(performance_score), avg_performance, performance_score))

updated_emp_data
```

```{r ex-3a, exercise = TRUE, exercise.completion = FALSE}

```

```{r ex-3a-hint-1}
joined_emp_data <- ___ |> 
    ___(___, by = ___)

___
```

```{r ex-3a-hint-2}
joined_emp_data <- ___ |> 
    inner_join(___, by = "employee_id")

joined_emp_data
```

```{r ex-3a-solution, exercise.reveal_solution = FALSE}
joined_emp_data <- updated_emp_data |> 
    inner_join(emp_salary_data, by = "employee_id")

joined_emp_data
```

```{r ex-3a-check}
grade_this({
    pass_if_equal()
    fail()
})
```


**Part 2**  
While comparing the `updated_emp_data` and `emp_salary_data` datasets, you realize some employees present in the `updated_emp_data` dataset are missing in the `emp_salary_data` dataset. Identify these employees. Save the result in a variable named `missing_employees` and then print the variable.  

*Hint: Use the anti_join() function.*  

```{r ex-3b, exercise = TRUE, exercise.setup = "ex-3a-setup", exercise.completion = FALSE}

```

```{r ex-3b-hint-1}
missing_employees <- ___ |> 
    ___(___, by = ___)

missing_employees
```

```{r ex-3b-hint-2}
missing_employees <- emp_salary_data |> 
    ___(updated_emp_data, by = ___)

missing_employees
```

```{r ex-3b-solution, exercise.reveal_solution = FALSE}
missing_employees <- emp_salary_data |> 
    anti_join(updated_emp_data, by = "employee_id")

missing_employees
```

```{r ex-3b-check}
grade_this({
    pass_if_equal()
    fail()
})
```


### Exercise 4
The HR department wants to categorize employees based on their age to better understand the age distribution within the company. Using the `updated_emp_data` dataset, create a new column named `seniority`. This column should categorize employees as "Junior" if their age is less than 35, "Mid-level" if their age is between 35 and 45 (inclusive), and "Senior" if their age is more than 45. Relocate the `seniority` variable to after the `age` variable. Save the result in a variable called `final_emp_data`. View the `final_emp_data` tibble.  

*Hint: You can use the `mutate()`, `case_when()`, and `relocate()` functions to accomplish this. If you need help with the functions, you can type ?function_name (e.g., `?case_when`) in your console to access the help documentation.*  

```{r ex-4, exercise = TRUE, exercise.setup = "ex-3a-setup", exercise.completion = FALSE}

```

```{r ex-4-hint-1}
___ <- ___ |> 
    ___(___ = ___(
        ___ < ___ ~ "Junior",
        ___ >= ___ & ___ <= 45 ~ ___,
        ___ ~ ___ 
    ))

___
```

```{r ex-4-hint-2}
final_emp_data <- ___ |> 
    mutate(___ = case_when(
        age < 35 ~ "Junior",
        ___ >= 35 & ___ <= 45 ~ ___,
        TRUE ~ "Senior" 
    ))

final_emp_data
```

```{r ex-4-solution, exercise.reveal_solution = FALSE}
final_emp_data <- updated_emp_data |> 
    mutate(seniority = case_when(
        age < 35 ~ "Junior",
        age >= 35 & age <= 45 ~ "Mid-level",
        TRUE ~ "Senior" 
    ))

final_emp_data
```

```{r ex-4-check}
grade_this({
    pass_if_equal()
    fail()
})
```



**Congratulations on completing the exercises!**  

Remember to keep practicing. The more you code, the more comfortable you'll get with these concepts.  

